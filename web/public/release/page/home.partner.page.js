$(document).ready(function(){var e={modal:$("#editOrAddModal"),listContainer:$(".js_table_list"),progress:$(".js_progress_section"),progressBar:$(".progress-bar"),imgPreview:$(".js_img_preview"),inputUrl:$("#js_modal_url"),inputImg:$("#js_modal_img"),setModalFormData:function(t){var n=e.modal.find(".modal-title");n.html(n.data("edit"));var r="";t.logo&&(r=document.global_config_data.img_host+t.logo),e.imgPreview.attr("src",r).removeClass("gone"),e.inputUrl.val(t.url),e.inputImg.val(t.logo)},clearModalFormData:function(){var t=e.modal.find(".modal-title");t.html(t.data("new")),e.imgPreview.addClass("gone").attr("src",""),e.inputUrl.val(""),e.inputImg.val("")},initBtnEvent:function(){$(document).on("click",".js_edit",function(){e.clearModalFormData();var t=e.modal.find(".submit"),n=$(this),r=n.parents("tr"),i=r.attr("data-id"),s=r.attr("data-info");i&&s&&(s=JSON.parse(s),e.setModalFormData(s)),e.modal.modal(),t.unbind().bind("click",function(){var t={id:i,logo:$.trim(e.inputImg.val()),url:$.trim(e.inputUrl.val())};if(!t.logo)return $.showToast("请上传图片",!1),!1;$.wpost("/home/update-partner-ajax",t,function(n){t.id?r.replaceWith(n):e.listContainer.prepend(n),$.showToast("保存成功",!0),e.modal.modal("hide")})})}),$(document).on("click",".js_delete",function(){var e=$(this),t=e.parents("tr"),n=t.attr("data-id");$.confirm({content:"确认删除吗",success:function(){$.wpost("/home/delete-partner-ajax",{id:n},function(){$.showToast("删除成功",!0),e.parents("tr").remove()})}})}),$(".js_upload_image").unbind().bind("click",function(){$(this).uploadImage("/upload/upload-image",{request_type:"ajax"},function(t){t.path&&(e.inputImg.val(t.path),e.imgPreview.attr("src",t.img).removeClass("gone")),e.progress.addClass("gone")},function(t){t>=0&&e.progress.removeClass("gone"),e.progressBar.css("width",t+"%")})}),$(document).on("click",".js_up,.js_down",function(){var e=$(this),t=$(e.parents(".js_modal_param")[0]);t.length==0&&(t=$(e.parents("tr")));var n;e.hasClass("js_up")?n=t.prev()[0]:n=t.next()[0];if(!n)return!1;e.hasClass("js_up")?$(n).before(t):$(n).after(t)}),$(document).on("click",".js_sort_save",function(){var e=$(".js_table_list tr"),t=[];for(var n=0;n<e.length;n++){var r=$(e[n]),i=r.data("id");if(i){var s={id:i,sort_num:n+1};t.push(s)}}if(t.length<1)return $.showToast("无可排序的数据",!1),!1;$.wpost("/home/save-partner-sort-ajax",{params:t},function(){$.showToast("保存成功",!0)})})},run:function(){e.initBtnEvent()}};e.run()});