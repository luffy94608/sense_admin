$(document).ready(function(){var e={modal:$("#editOrAddModal"),pagerObj:"",listContainer:$(".js_table_list"),uploadImageBtn:".js_upload_image",imgPreview:$(".js_modal_pic_preview"),inputName:$("#js_modal_name"),inputDownload:$("#js_modal_download"),paramsAddBtn:$(".js_modal_params_add_btn"),paramsSection:$(".js_modal_params"),paramsCloneNode:$(".jmp_node .js_modal_param",$(".js_modal_params")),paramsSectionList:$(".jmp_list",$(".js_modal_params")),initSelectBtn:function(){e.inputDownload.select2({placeholder:"选择sdk下载文件",allowClear:!0})},initTypeChangeEvent:function(e){var t=$("#radio_type_"+e),n=t.data("id");t.prop("checked",!0),$(".js_type_section").addClass("gone"),$(n).removeClass("gone")},initModalParamsEvent:function(){e.paramsAddBtn.unbind().bind("click",function(){var t=e.paramsCloneNode.clone();e.paramsSectionList.append(t)}),$(document).on("click",".jmp_delete",function(){$(this).parents(".js_modal_param").remove()})},getModalParamsData:function(){var t=$(".js_modal_param",e.paramsSectionList),n=t.length,r=[];return n&&t.each(function(e){var t=$(this).find("input"),n=$(this).find("textarea"),i={id:$.trim(t.eq(0).val()),name:$.trim(t.eq(1).val()),content:$.trim(n.val()),sort_num:e+1};i.name.length&&i.content.length&&r.push(i)}),r},setModalParamsData:function(t){t&&t.forEach(function(t){var n=e.paramsCloneNode.clone(),r=$(n).find("input");r.eq(0).val(t.id),r.eq(1).val(t.name),$(n).find("textarea").val(t.content),e.paramsSectionList.append(n)})},clearModalParamsData:function(){e.paramsSectionList.html("")},setModalFormData:function(t){var n=e.modal.find(".modal-title");n.html(n.data("edit")),e.inputName.val(t.name),e.initTypeChangeEvent(t.type),e.inputDownload.select2("val",t.download_ids.split(",")),t.params&&e.setModalParamsData(t.params)},clearModalFormData:function(){var t=e.modal.find(".modal-title");t.html(t.data("new")),e.inputDownload.select2("val",""),e.clearModalParamsData(),e.initTypeChangeEvent(0)},initPager:function(){e.pagerObj=$("#wrapperPageList").Pager({protocol:"/manage/get-cloud-list-ajax",listSize:20,onPageInitialized:function(){if(e.pagerObj){var t=$(window).scrollTop();t>100&&$(window).scrollTop(0)}},wrapUpdateData:function(e,t){var n={};return n&&$.extend(t,n),t}}),e.pagerObj.updateList(0)},initBtnEvent:function(){$(document).on("click",".js_edit",function(){e.clearModalFormData();var t=e.modal.find(".js_submit"),n=$(this),r=n.parents("tr"),i=r.data("id"),s=r.data("info");i&&s&&e.setModalFormData(s),e.modal.modal(),t.unbind().bind("click",function(){var t={id:i,name:$.trim(e.inputName.val()),download_ids:$.trim(e.inputDownload.select2("val")),params:e.getModalParamsData(),type:$(".js_radio_type:checked").val()},n={name:"请输入描述"};for(var s in n)if(!t[s]||t[s].length<1)return $.showToast(n[s],!1),!1;if(t.type==1){if(!t.download_ids||t.download_ids.length<1)return $.showToast("请选择下载文件",!1),!1}else if(!t.params||t.params.length<1)return $.showToast("请添加列表内容",!1),!1;$.wpost("/manage/update-cloud-ajax",t,function(n){t.id?r.replaceWith(n):e.listContainer.append(n),$.showToast("保存成功",!0),e.modal.modal("hide")})})}),$(document).on("click",".js_delete",function(){var e=$(this),t=e.parents("tr"),n=t.attr("data-id");$.confirm({content:"确认删除吗",success:function(){$.wpost("/manage/delete-cloud-ajax",{id:n},function(){$.showToast("删除成功",!0),e.parents("tr").remove()})}})}),$(document).on("click",".js_up,.js_down",function(){var e=$(this),t=$(e.parents(".js_modal_param")[0]);t.length==0&&(t=$(e.parents("tr")));var n;e.hasClass("js_up")?n=t.prev()[0]:n=t.next()[0];if(!n)return!1;e.hasClass("js_up")?$(n).before(t):$(n).after(t)}),$(document).on("click",".js_sort_save",function(){var e=$(".js_table_list tr"),t=[];for(var n=0;n<e.length;n++){var r=$(e[n]),i=r.data("id");if(i){var s={id:i,sort_num:n+1};t.push(s)}}if(t.length<1)return $.showToast("无可排序的数据",!1),!1;$.wpost("/manage/save-cloud-sort-ajax",{params:t},function(){$.showToast("保存成功",!0)})}),$(".js_radio_type").unbind().bind("click",function(){e.initTypeChangeEvent($(this).val())})},run:function(){e.initSelectBtn(),e.initModalParamsEvent(),e.initPager(),e.initBtnEvent()}};e.run()});