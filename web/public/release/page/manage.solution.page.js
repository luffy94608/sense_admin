$(document).ready(function(){var e={modal:$("#editOrAddModal"),listContainer:$(".js_table_list"),pagerObj:"",uploadImageBtn:".js_upload_image",uploadProgressModal:"#uploadAppProgressModal",bannerPreview:$(".js_modal_banner_preview"),picPreview:$(".js_modal_pic_preview"),inputName:$("#js_modal_name"),inputTitle:$("#js_modal_title"),inputBanner:$("#js_modal_banner"),inputPic:$("#js_modal_pic"),inputDemand:$("#js_modal_demand"),inputPlan:$("#js_modal_plan"),inputAdvantage:$("#js_modal_advantage"),setModalFormData:function(t){var n=e.modal.find(".modal-title");n.html(n.data("edit"));var r=document.global_config_data.img_host,i,s;t.pic&&(s=r+t.pic),e.picPreview.attr("src",s).removeClass("gone"),e.inputName.val(t.name),e.inputTitle.val(t.title),e.inputPic.val(t.pic),e.inputDemand.val(t.demand),e.inputPlan.val(t.plan),e.inputAdvantage.val(t.advantage)},clearModalFormData:function(){var t=e.modal.find(".modal-title");t.html(t.data("new")),e.bannerPreview.addClass("gone").attr("src",""),e.picPreview.addClass("gone").attr("src",""),e.inputName.val(""),e.inputTitle.val(""),e.inputPic.val(""),e.inputDemand.val(""),e.inputPlan.val(""),e.inputAdvantage.val("")},initBtnEvent:function(){$(document).on("click",".js_edit",function(){e.clearModalFormData();var t=e.modal.find(".js_submit"),n=$(this),r=n.parents("tr"),i=r.data("id"),s=r.data("info");i&&s&&e.setModalFormData(s),e.modal.modal(),t.unbind().bind("click",function(){var t={id:i,name:$.trim(e.inputName.val()),title:$.trim(e.inputTitle.val()),pic:$.trim(e.inputPic.val()),demand:$.trim(e.inputDemand.val()),plan:$.trim(e.inputPlan.val()),advantage:$.trim(e.inputAdvantage.val())},n={name:"方案名称",title:"简述",pic:"缩略图",demand:"背景和需求",plan:"解决方案",advantage:"优势"};for(var s in n)if(!t[s])return $.showToast("请输入"+n[s],!1),!1;$.wpost("/manage/update-solution-ajax",t,function(n){t.id?r.replaceWith(n):e.listContainer.prepend(n),$.showToast("保存成功",!0),e.modal.modal("hide")})})}),$(document).on("click",".js_delete",function(){var t=$(this),n=t.parents("tr"),r=n.attr("data-id");$.confirm({content:"确认删除吗",success:function(){$.wpost("/manage/delete-solution-ajax",{id:r,type:e.type},function(){$.showToast("删除成功",!0),t.parents("tr").remove()})}})}),$(e.uploadImageBtn).unbind().bind("click",function(){var t=$(this),n=$(e.uploadProgressModal);$(this).uploadImage("/upload/upload-image",{request_type:"ajax"},function(e){var r=t.data("id");e.res&&($("#"+r).val(e.path),$("."+r+"_preview").attr("src",e.url).removeClass("gone")),n.modal("hide"),$(".progress-bar",n).css("width",0)},function(e){n.modal({backdrop:"static",keyboard:!1}),$(".progress-bar",n).css("width",e+"%")})}),$(document).on("click",".js_up,.js_down",function(){var e=$(this),t=$(e.parents(".js_modal_param")[0]);t.length==0&&(t=$(e.parents("tr")));var n;e.hasClass("js_up")?n=t.prev()[0]:n=t.next()[0];if(!n)return!1;e.hasClass("js_up")?$(n).before(t):$(n).after(t)}),$(document).on("click",".js_sort_save",function(){var e=$(".js_table_list tr"),t=[];for(var n=0;n<e.length;n++){var r=$(e[n]),i=r.data("id");if(i){var s={id:i,sort_num:n+1};t.push(s)}}if(t.length<1)return $.showToast("无可排序的数据",!1),!1;$.wpost("/manage/save-solution-sort-ajax",{params:t},function(){$.showToast("保存成功",!0)})})},run:function(){e.initBtnEvent()}};e.run()});