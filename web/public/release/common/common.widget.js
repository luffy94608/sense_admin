(function(e){e.log=function(e){console.log(e)},e.fn.wclick=function(t){e(this).click(function(e){!1===t.call(this,e)&&e.preventDefault()})},e.confirm=function(t){var n={title:"提示",content:"内容",cancelTitle:"取消",confirmTitle:"确定",success:function(){},cancel:function(){}};e.extend(n,t);var r=e("#global_confirm_modal");r.find(".modal-title").html(n.title),r.find(".modal-body").html(n.content),r.find(".confirm_button").unbind().wclick(function(){e.isFunction(n.success)&&n.success(),r.modal("hide")}),r.find(".cancel_button").unbind().wclick(function(){e.isFunction(n.cancel)&&n.cancel(),r.modal("hide")}),r.modal()},e.showToast=function(t,n,r){var i={toastID:"toast-new",dur:2e3};if(typeof t!="string")throw"Invalid param of $.showToast";if(e("#"+i.toastID).length==0){var s='<section id="'+i.toastID+'" class="gone">                <div class="toast-box">                </div>            </section>';e("body").append(s)}var o=e("#"+i.toastID),u=o.find(".toast-box"),a=function(){u.empty().append("<p>")},f=function(){var t=e(window).height(),n=t/2-30;o.css("top",n+"px")},l=function(t){o.fadeIn(300),setTimeout(function(){o.fadeOut(300),e.isFunction(r)&&setTimeout(r,300)},t)},c=function(){typeof n=="boolean"&&(n?u.find("p").addClass("yea"):u.find("p").addClass("nay"))};a(),c(),u.find("p").append(t),f(),l(i.dur)},e.initLoginDialog=function(){var t=e("#global_login_modal");t.find("#glm_name").val(""),t.find("#glm_password").val(""),t.modal();var n=t.find(".confirm_button");n.unbind().wclick(function(){var n={account:e.trim(t.find("#glm_name").val()),password:e.trim(t.find("#glm_password").val())};if(!n.account)return e.showToast("请输入用户名",!1),!1;if(!n.password)return e.showToast("请输入密码",!1),!1;e.wpost("/index/check-password",n,function(e){t.modal("hide")})})},e.wpost=function(t,n,r,i,s){var o=e("body");n==null&&(n={}),n.request_type="ajax",s||e("body").modalmanager("loading"),e.log(">>>>>>>>>>>>>"+t+">>>>>>>>>>>>>>>"),jQuery.ajax({type:"post",url:t,data:n,success:function(t){e.log("==========="),e.log(t),s||e("body").modalmanager("removeLoading");if(t.code==0)e.isFunction(r)&&r(t.data);else{if(parseInt(t.code)==-100){e.showToast(t.desc,!1);return}if(parseInt(t.code)==-302){e("#global_login_modal").modal(),e.initLoginDialog();return}e.isFunction(i)?i(t):e.showToast(t.desc,!1)}},error:function(t,n,r){if(n){var i=n+"<br>status:"+t.status+" "+t.statusText+"<br>";e.showToast("服务器错误",!1)}else e.showToast(r.description,!1);s||e("body").modalmanager("removeLoading")},dataType:"json"})},e.fn.uploadImage=function(t,n,r,i){e(this).next('input[type="file"]').remove();var s=e(' <input style="display:none;" type="file" name="file"/>'),o=e(this);s.change(function(){var s=new XMLHttpRequest;o.data("_sid","_sid_"+Math.random()),s.upload.onprogress=function(t){var n=t.loaded/t.total,r=n*100;e.isFunction(i)&&i(r),e("#"+o.data("_sid")).html(r+"%")},s.onload=function(){this.status==200&&r&&r(e.parseJSON(this.responseText).data),e("#"+o.data("_sid")).remove()},s.open("POST",t,!0);var u=new FormData;u.append("image",this.files[0]);if(n)for(var a in n)u.append(a,n[a]);s.send(u)}),e(this).after(s),s.click()},Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)(new RegExp("("+n+")")).test(e)&&(e=e.replace(RegExp.$1,RegExp.$1.length==1?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e},String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return typeof e[n]!="undefined"?e[n]:t})},e.fn.Pager=function(t){var n={url:null,currentPage:0,protocol:null,listSize:20,onPageInitialized:null,onCountChanged:null,wrapUpdateData:null},r=e(this);return e.extend(n,t),r.currentIdx=function(){return n.currentPage},r.initTabPage=function(){var t=r.find("#list_count").html(),i=parseInt((parseInt(t)+n.listSize-1)/n.listSize),s=r.find("#pager_indicator").PagerIndicator({url:n.url?n.url:null,currentPage:n.currentPage,totalCount:t,totalPage:i,pageSize:5,onPageChange:function(e){n.currentPage=e,r.updateList(e),s.invalidate()}});e.isFunction(n.onPageInitialized)&&n.onPageInitialized(r)},r.setEmpty=function(e){r.find("#list").empty().html(e)},r.updateList=function(t){var i={offset:t*n.listSize,length:n.listSize};e.isFunction(n.wrapUpdateData)&&(i=n.wrapUpdateData(t,i)),e.wpost(n.protocol,i,function(i){r.find("#list_count").html(i.total),r.find("#list").html(i.html),e.isFunction(n.onCountChanged)&&n.onCountChanged(i.total),r.initTabPage(t)})},r.initTabPage(),r},e.fn.PagerIndicator=function(t){var n={url:null,totalCount:0,totalPage:1,currentPage:0,pageSize:3,updateWhenInit:!1,showLast:!0,onPageChange:null},r=e(this),i="",s="",o="active",u=e("<li class='paginate_button'><a href='javascript:void(0);'></a></li>"),a=e("<li class='paginate_button' style='padding:0px 5px 0px 0px;'></li>"),f="首页",l="末页",c="上一页",h="下一页";t!=n&&e.extend(n,t),n.totalPage=Math.max(1,n.totalPage),n.currentPage=Math.min(Math.max(n.currentPage,0),n.totalPage-1),n.url&&(n.url.indexOf("?")>0?n.url=n.url+"&":n.url=n.url+"?");var p=n.pageSize&1?0:1,d=n.pageSize-1>>1,v=Math.max(0,Math.min(n.currentPage+d,n.totalPage-1)-n.pageSize+1),m=Math.min(n.totalPage-1,Math.max(n.currentPage-d,0)+n.pageSize-1),g=n.currentPage==0,y=n.currentPage==n.totalPage-1,b=Math.max(n.currentPage-1,0),w=Math.min(n.currentPage+1,n.totalPage-1),E=[{html:f,title:f,disabled:g,desIdx:0,style:g?i:s}];E.push({html:c,title:c,disabled:g,desIdx:b,style:g?i:s});for(var S=v;S<=m;S++){var x=S==n.currentPage,T=x?o:s;E.push({html:S+1,title:S+1,style:T,disabled:x,desIdx:S,isNum:!0})}E.push({html:h,title:h,disabled:y,desIdx:w,style:y?i:s}),n.showLast&&E.push({html:l,title:l,disabled:y,desIdx:n.totalPage-1,style:y?i:s}),r.empty();if(n.totalCount>0){var N=e('<li class="paginate_button"><div class="page_info"></div></li>').find(".page_info").html('总数<span class="number">'+n.totalCount+'</span>,共<span class="number">'+n.totalPage+"</span>页");n.totalPage>1&&(N.append('<input type="text" placeholder="GO" class="input_go">'),N.find("input").keypress(function(t){if(t.keyCode==13){var r=parseInt(e(this).val(),10);n.url?location.href=n.url+"page="+r:0<r&&r<=n.totalPage&&e.isFunction(n.onPageChange)&&n.onPageChange(r-1)}})),N.parent().appendTo(r)}return n.totalPage>1&&e.each(E,function(t,i){if(i.disabled&&!i.isNum&&!1)a.clone().appendTo(r).html(i.html).attr("title",i.title).addClass(i.style);else if(n.currentPage==i.desIdx){var s=u.clone().appendTo(r);s.addClass(i.style),s.find("a").html(i.html).addClass(i.style)}else n.url==null?u.clone().appendTo(r).find("a").html(i.html).attr("title",i.title).addClass(i.style).wclick(function(){return n.currentPage=i.desIdx,e.isFunction(n.onPageChange)&&n.onPageChange(i.desIdx),!1}):u.clone().appendTo(r).find("a").html(i.html).attr("title",i.title).addClass(i.style).attr("href",n.url+"page="+(i.desIdx+1)).attr("target","_top")}),r.invalidate=function(){r.PagerIndicator(n)},n.updateWhenInit&&e.isFunction(n.onPageChange)&&n.onPageChange(n.currentPage),r.currentPage=function(){return n.currentPage},r},e.getByteLength=function(e){if(!e)return 0;var t=0;for(var n=0;n<e.length;n++)e.substr(n,1).match(/[^\x00-\xff]/ig)!=null?t+=2:t+=1;return t},e.hintFormatter={empty:"{0}为必填项",tooShort:"{0}至少{1}个字",tooLong:"{0}最多{1}个字",bad:"{0}格式不对"},e.defaultVerifyConfig={name:{min:4,max:16,banSpecial:!0,title:"真实姓名",hasSpecial:function(e){var t=/^[\u4E00-\u9FA5a-zA-Z\s]+$/;if(t.test(e)){var n=/^（）[！？。，《》{}【】“”·、：；‘’……]+$/;return n.test(e)}return!0},test:function(e){return!0}},account:{min:-1,max:1e3,title:"账号",test:function(e){return!0}},email:{min:-1,max:-1,title:"邮箱",test:function(e){var t=/^[a-z0-9]+([._-]*[a-z0-9]+)*@([a-z0-9\-_]+([.\_\-][a-z0-9]+))+$/i;return t.test(e)}},url:{min:-1,max:-1,title:"URL",test:function(e){var t=/^(https?:\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;return t.test(e)}},qq:{min:5,max:15,title:"QQ",test:function(e){var t=/^[1-9][0-9]{4,}$/i;return t.test(e)}},mobile:{min:-1,max:-1,title:"手机号",test:function(e){var t=/^(\+|00)?[0-9\s\-]{3,20}$/;return t.test(e)}},phone:{min:-1,max:-1,title:"电话",test:function(e){var t=/^(\+|00)?[0-9\(\)\-\,\s]{3,20}$/;return t.test(e)}},number:{min:-1,max:-1,title:"号码",test:function(e){var t=/^[0-9]+$/i;return t.test(e)}}},e.checkInputVal=function(t){var n={val:null,onChecked:function(e,t,n){},type:null,showHint:!1,required:!0};n=e.extend(n,t),n.onChecked=e.isFunction(n.onChecked)?n.onChecked:function(e,t,n){};var r=function(t,n){return t==0?e.hintFormatter.empty.format(n.title):t==-1?e.hintFormatter.tooShort.format(n.title,parseInt((n.min+1)/2)):t==-2?e.hintFormatter.tooLong.format(n.title,parseInt(n.max/2)):t==-3?e.hintFormatter.bad.format(n.title):""},i=n.val,i=jQuery.trim(i),s=e.defaultVerifyConfig[n.type];if(!i||i.length==0)return n.onChecked(i,0,r(0,s)),0;var o=e.getByteLength(i);if(s.min>0&&o<s.min)return n.onChecked(i,-1,r(-1,s)),-1;if(s.max>0&&o>s.max)return n.onChecked(i,-2,r(-2,s)),-2;if(s.banSpecial)if(e.isFunction(s.hasSpecial)){if(s.hasSpecial(i))return n.onChecked(i,-4,"不能包含特殊字符"),-4}else{var u=/^[\u4E00-\u9FA5a-zA-Z0-9\s\.\,\(\)\+#\-]+$/;if(!u.test(i))return n.onChecked(i,-4,"不能包含特殊字符"),-4;var a=/^[（）！？。，《》{}【】“”·、：；‘’……]+$/;if(a.test(i))return n.onChecked(i,-4,"不能包含特殊字符"),-4}return s.test(i)?(n.onChecked(i,1,""),1):(n.onChecked(i,-3,r(-3,s)),-3)},e.fn.initDataTableWithAdvance=function(t){function u(e,t){var n=e.fnGetData(t),r="<table>";return r+="<tr><td>Platform(s):</td><td>"+n[2]+"</td></tr>",r+="<tr><td>Engine version:</td><td>"+n[3]+"</td></tr>",r+="<tr><td>CSS grade:</td><td>"+n[4]+"</td></tr>",r+="<tr><td>Others:</td><td>Could provide a link here</td></tr>",r+="</table>",r}var n=e(this),r=n.attr("id"),i={isShowTrDetail:!1};e.fn.DataTable.TableTools&&e.extend(!0,e.fn.DataTable.TableTools.classes,{container:"btn-group tabletools-btn-group pull-right",buttons:{normal:"btn btn-sm default",disabled:"btn btn-sm default disabled"}});var s={language:{aria:{sortAscending:": 以升序排列此列",sortDescending:": 以降序排列此列"},emptyTable:"表中数据为空",info:"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",infoEmpty:"没有数据",infoFiltered:"(由 _MAX_ 条数据中检索)",lengthMenu:"显示 _MENU_ 数据",search:"搜索:",zeroRecords:"没有匹配结果",paging:{first:"首页",previous:"上一页",next:"下一页",last:"末页"}},ordering:!0,columnDefs:[{orderable:!1,targets:[]}],order:[[1,"asc"]],lengthMenu:[[5,10,15,20,-1],[5,10,15,20,"全部"]],pageLength:20,bStateSave:!1};e.extend(s,i),e.extend(s,t);var o=n.dataTable(s);if(s.isShowTrDetail){var a=document.createElement("th");a.className="table-checkbox";var f=document.createElement("td");f.innerHTML='<span class="row-details row-details-close"></span>',n.find("thead tr").each(function(){this.insertBefore(a,this.childNodes[0])}),n.find("tbody tr").each(function(){this.insertBefore(f.cloneNode(!0),this.childNodes[0])}),n.on("click"," tbody td .row-details",function(){var t=e(this).parents("tr")[0];o.fnIsOpen(t)?(e(this).addClass("row-details-close").removeClass("row-details-open"),o.fnClose(t)):(e(this).addClass("row-details-open").removeClass("row-details-close"),o.fnOpen(t,u(o,t),"details"))})}var l=e("#"+r+"_wrapper"),c=e("#"+r+"_column_toggler");return e('input[type="checkbox"]',c).change(function(){var t=parseInt(e(this).attr("data-column")),n=o.fnSettings().aoColumns[t].bVisible;o.fnSetColumnVis(t,n?!1:!0)}),o}})(jQuery);