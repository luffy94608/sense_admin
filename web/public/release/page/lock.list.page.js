$(document).ready(function(){var e={modal:$("#editOrAddModal"),listContainer:$(".js_table_list"),progress:$(".js_progress_section"),progressBar:$(".progress-bar"),imgPreview:$(".js_img_preview"),inputVersion:$("#js_modal_version"),inputType:$("#js_modal_type"),inputShopUrl:$("#js_modal_shop_url"),inputStatus:$("#js_modal_status"),inputDownload:$("#js_modal_download"),inputImg:$("#js_modal_img"),inputDesc:$("#js_modal_desc"),inputFeature:$("#js_modal_feature"),paramsAddBtn:$(".js_modal_params_add_btn"),paramsSection:$(".js_modal_params"),paramsCloneNode:$(".jmp_node .js_modal_param",$(".js_modal_params")),paramsSectionList:$(".jmp_list",$(".js_modal_params")),initSelectBtn:function(){e.inputDownload.select2({placeholder:"选择sdk下载文件",allowClear:!0})},initModalParamsEvent:function(){e.paramsAddBtn.unbind().bind("click",function(){var t=e.paramsCloneNode.clone();e.paramsSectionList.append(t)}),$(document).on("click",".jmp_delete",function(){$(this).parents(".js_modal_param").remove()})},getModalParamsData:function(){var t=$(".js_modal_param",e.paramsSectionList),n=t.length,r=[];return n&&t.each(function(e){var t=$(this).find("input"),n={id:$.trim(t.eq(0).val()),key:$.trim(t.eq(1).val()),value:$.trim(t.eq(2).val()),desc:$.trim(t.eq(3).val()),sort_num:e+1};r.push(n)}),r},setModalParamsData:function(t){t&&t.forEach(function(t){var n=e.paramsCloneNode.clone(),r=$(n).find("input");r.eq(0).val(t.id),r.eq(1).val(t.param_1),r.eq(2).val(t.param_2),r.eq(3).val(t.param_3),e.paramsSectionList.append(n)})},clearModalParamsData:function(){e.paramsSectionList.html("")},setModalFormData:function(t){var n=e.modal.find(".modal-title");n.html(n.data("edit"));var r="";t.pic&&(r=document.global_config_data.img_host+t.pic),e.imgPreview.attr("src",r).removeClass("gone"),e.inputVersion.val(t.version),e.inputShopUrl.val(t.shop_url),e.inputType.val(t.lock_type_id),t.try_status==1&&e.inputStatus.prop("checked",!0),e.inputDownload.select2("val",t.download_ids.split(",")),e.inputImg.val(t.pic),e.inputDesc.val(t.description),e.inputFeature.val(t.feature),t.params&&e.setModalParamsData(t.params)},clearModalFormData:function(){var t=e.modal.find(".modal-title");t.html(t.data("new")),e.imgPreview.addClass("gone").attr("src",""),e.inputVersion.val(""),e.inputType.val(""),e.inputShopUrl.val(""),e.inputStatus.prop("checked",!1),e.inputDownload.select2("val",""),e.inputImg.val(""),e.inputDesc.val(""),e.inputFeature.val(""),e.clearModalParamsData()},initBtnEvent:function(){$(document).on("click",".js_edit",function(){e.clearModalFormData();var t=e.modal.find(".js_submit"),n=$(this),r=n.parents("tr"),i=r.data("id"),s=r.data("info");i&&s&&e.setModalFormData(s),e.modal.modal(),t.unbind().bind("click",function(){var t={id:i,version:$.trim(e.inputVersion.val()),type_id:$.trim(e.inputType.val()),shop_url:$.trim(e.inputShopUrl.val()),status:e.inputStatus.prop("checked")?1:0,download_ids:$.trim(e.inputDownload.select2("val")),pic:$.trim(e.inputImg.val()),desc:$.trim(e.inputDesc.val()),feature:$.trim(e.inputFeature.val()),params:e.getModalParamsData()},n={version:"请输入版本名称",type_id:"请选择产品类别",download_ids:"请选择sdk下载文件",pic:"请上传产品图",desc:"请输入产品信息",feature:"请输入产品特点",params:"请添加基本参数"};for(var s in n)if(!t[s]||t[s].length<1)return $.showToast(n[s],!1),!1;$.wpost("/lock/update-lock-ajax",t,function(n){t.id?r.replaceWith(n):e.listContainer.append(n),$.showToast("保存成功",!0),e.modal.modal("hide")})})}),$(document).on("click",".js_delete",function(){var e=$(this),t=e.parents("tr"),n=t.attr("data-id");$.confirm({content:"确认删除吗",success:function(){$.wpost("/lock/delete-lock-ajax",{id:n},function(){$.showToast("删除成功",!0),e.parents("tr").remove()})}})}),$(".js_upload_image").unbind().bind("click",function(){$(this).uploadImage("/upload/upload-image",{request_type:"ajax"},function(t){t.path&&(e.inputImg.val(t.path),e.imgPreview.attr("src",t.url).removeClass("gone")),e.progress.addClass("gone")},function(t){t>=0&&e.progress.removeClass("gone"),e.progressBar.css("width",t+"%")})}),$(document).on("click",".js_up,.js_down",function(){var e=$(this),t=$(e.parents(".js_modal_param")[0]),n;e.hasClass("js_up")?n=t.prev()[0]:n=t.next()[0];if(!n)return!1;e.hasClass("js_up")?$(n).before(t):$(n).after(t)})},run:function(){e.initSelectBtn(),e.initModalParamsEvent(),e.initBtnEvent()}};e.run()});