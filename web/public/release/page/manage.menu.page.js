$(document).ready(function(){var e={modal:$("#editOrAddModal"),pagerObj:"",listContainer:$(".js_table_list"),uploadImageBtn:".js_upload_image",uploadProgressModal:"#uploadAppProgressModal",inputName:$("#js_modal_name"),inputType:$("#js_modal_type"),inputTarget:$("#js_modal_target"),inputParent:$("#js_modal_parent"),inputShowType:$("#js_modal_show_type"),inputBtnTypeNode:".js_radio_btn_type",inputUrl:$("#js_modal_url"),inputPage:$("#js_modal_page"),typeParams:"",paramsAddBtn:$(".js_modal_params_add_btn"),paramsSection:$(".js_modal_params"),paramsCloneNode:$(".jmp_node .js_modal_param",$(".js_modal_params")),paramsSectionList:$(".jmp_list",$(".js_modal_params")),initModalParamsEvent:function(){e.paramsAddBtn.unbind().bind("click",function(){var t=e.paramsCloneNode.clone();e.paramsSectionList.append(t)}),$(document).on("click",".jmp_delete",function(){$(this).parents(".js_modal_param").remove()})},getModalParamsData:function(){var t=$(".js_modal_param",e.paramsSectionList),n=t.length,r=[];return n&&t.each(function(e){var t={id:$.trim($(this).find(".js_mp_id").val()),name:$.trim($(this).find(".js_mp_name").val()),target:$.trim($(this).find(".js_mp_target").val()),btn_type:$.trim($(this).find(".js_mp_btn_type").val()),url:$.trim($(this).find(".js_mp_url").val()),module:$.trim($(".nav-tabs li.active").data("id")),page_id:$.trim($(this).find(".js_mp_page").val()),sort_num:e+1};t.btn_type==1?t.url="":t.page_id="",t.name.length&&r.push(t)}),r},setModalParamsData:function(t){t&&t.forEach(function(t){var n=e.paramsCloneNode.clone();$(n).find(".js_mp_id").val(t.id),$(n).find(".js_mp_name").val(t.name),$(n).find(".js_mp_target").val(t.target),$(n).find(".js_mp_btn_type").val(t.btn_type),$(n).find(".js_mp_url").val(t.url),$(n).find(".js_mp_page").val(t.page_id),e.paramsSectionList.append(n);var r=$(n).find(".js_mp_btn_type_target_sec");r.addClass("gone"),r.eq(t.btn_type).removeClass("gone")})},clearModalParamsData:function(){e.paramsSectionList.html("")},setModalFormData:function(t){var n=e.modal.find(".modal-title");n.html(n.data("edit")),e.inputName.val(t.name),e.inputType.val(t.type),e.initTypeShowEvent(t.type),e.inputTarget.val(t.target),e.inputParent.val(t.parent_id),e.inputShowType.val(t.show_type),$(e.inputBtnTypeNode).eq(t.btn_type).prop("checked",!0),e.initBtnTypeShowEvent(t.btn_type),e.inputUrl.val(t.url),e.inputPage.val(t.page_id),t.params&&e.setModalParamsData(t.params)},clearModalFormData:function(){var t=e.modal.find(".modal-title");t.html(t.data("new")),e.inputName.val(""),e.inputType.val(1),e.initTypeShowEvent(1),e.inputTarget.val("_self"),e.inputParent.val(0),e.inputShowType.val(0),$(e.inputBtnTypeNode).eq(0).prop("checked",!0),e.initBtnTypeShowEvent(0),e.inputUrl.val("");var n=$.trim($(".nav-tabs li.active").data("id")),r=$(".js_modal_type_sec"),i=$(".js_modal_show_type_sec");n==1?(r.addClass("gone"),i.addClass("gone")):(r.removeClass("gone"),i.removeClass("gone")),e.clearModalParamsData()},initTypeShowEvent:function(e){var t=$(".js_modal_parent_section"),n=$(".js_modal_show_type_sec");if(e==2)t.removeClass("gone"),n.addClass("gone");else{t.addClass("gone");var r=$.trim($(".nav-tabs li.active").data("id"));r==0&&n.removeClass("gone")}},initBtnTypeShowEvent:function(e){$(".js_radio_target_section").addClass("gone"),e==1?$(".js_modal_page_section").removeClass("gone"):$(".js_modal_url_section").removeClass("gone")},btnSwitchEvent:function(){$(e.inputBtnTypeNode).unbind().bind("change",function(){var t=$(this).val();e.initBtnTypeShowEvent(t)}),e.inputType.unbind().bind("change",function(){var t=$(this).val();e.initTypeShowEvent(t)}),$(document).on("change",".js_mp_btn_type",function(){var e=$(this).val(),t=$(this).parents(".js_modal_param");$(".js_mp_btn_type_target_sec",t).addClass("gone"),e==0?t.find(".js_mp_url_sec").removeClass("gone"):t.find(".js_mp_page_sec").removeClass("gone")})},initTabEvent:function(){$(".nav-tabs li").unbind().bind("click",function(){e.typeParams=$(this).data("id"),e.pagerObj.updateList(0)})},initPager:function(){e.pagerObj=$("#wrapperPageList").Pager({protocol:"/manage/get-menu-list-ajax",listSize:20,onPageInitialized:function(){if(e.pagerObj){var t=$(window).scrollTop();t>100&&$(window).scrollTop(0)}},wrapUpdateData:function(t,n){var r=$(".nav-tabs li.active").data("id");e.typeParams.toString().length&&(r=e.typeParams);var i={module:r};return i&&$.extend(n,i),n}}),e.pagerObj.updateList(0)},initBtnEvent:function(){$(document).on("click",".js_edit",function(){e.clearModalFormData();var t=e.modal.find(".js_submit"),n=$(this),r=n.parents("tr"),i=r.data("id"),s=r.data("info");i&&s&&e.setModalFormData(s),e.modal.modal(),t.unbind().bind("click",function(){var t={id:i,name:$.trim(e.inputName.val()),type:$.trim(e.inputType.val()),target:$.trim(e.inputTarget.val()),parent_id:$.trim(e.inputParent.val()),show_type:$.trim(e.inputShowType.val()),btn_type:$.trim($(e.inputBtnTypeNode+":checked").val()),url:$.trim(e.inputUrl.val()),page_id:$.trim(e.inputPage.val()),module:$.trim($(".nav-tabs li.active").data("id")),params:e.getModalParamsData()},n={name:"请输入菜单名称"};for(var s in n)if(!t[s]||t[s].length<1)return $.showToast(n[s],!1),!1;if(t.type==2){if(t.parent_id<1)return $.showToast("请选择父级菜单",!1),!1}else t.parent_id="";t.btn_type==1?t.url="":t.page_id="",$.wpost("/manage/update-menu-ajax",t,function(n){t.id?r.replaceWith(n):e.listContainer.prepend(n),$.showToast("保存成功",!0),e.modal.modal("hide")})})}),$(document).on("click",".js_delete",function(){var e=$(this),t=e.parents("tr"),n=t.attr("data-id");$.confirm({content:"确认删除吗",success:function(){$.wpost("/manage/delete-menu-ajax",{id:n},function(){$.showToast("删除成功",!0),e.parents("tr").remove()})}})}),$(document).on("click",".js_up,.js_down",function(){var e=$(this),t=$(e.parents(".js_modal_param")[0]);t.length==0&&(t=$(e.parents("tr")));var n;e.hasClass("js_up")?n=t.prev()[0]:n=t.next()[0];if(!n)return!1;e.hasClass("js_up")?$(n).before(t):$(n).after(t)}),$(document).on("click",".js_sort_save",function(){var e=$(".js_table_list tr"),t=[];for(var n=0;n<e.length;n++){var r=$(e[n]),i=r.data("id");if(i){var s={id:i,sort_num:n+1};t.push(s)}}if(t.length<1)return $.showToast("无可排序的数据",!1),!1;$.wpost("/manage/save-menu-sort-ajax",{params:t},function(){$.showToast("保存成功",!0)})})},run:function(){e.btnSwitchEvent(),e.initTabEvent(),e.initPager(),e.initModalParamsEvent(),e.initBtnEvent()}};e.run()});