$(document).ready(function(e){var t="",n=function(){t&&t.fnDestroy(),t=e("#account_table_1").dataTable({language:{aria:{sortAscending:": 以升序排列此列",sortDescending:": 以降序排列此列"},emptyTable:"表中数据为空",info:"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",infoFiltered:"(由 _MAX_ 条数据中检索)",lengthMenu:"显示 _MENU_ 数据",search:"搜索:",zeroRecords:"没有匹配结果",paging:{first:"首页",previous:"上一页",next:"下一页",last:"末页"}},bStateSave:!0,lengthMenu:[[5,15,20,-1],[5,15,20,"All"]],pageLength:20,columnDefs:[{orderable:!1,targets:[0,1,2,6]},{searchable:!1,targets:[4,5]}],order:[[5,"desc"]]})};n();var r=e("#editUserInfoModal");e(document).on("click",".js_edit",function(){var t=r,n=e(this),i=t.find("#eui-confirm"),s=t.find(".modal-title"),o=n.attr("data-edit"),u;o==1?s.html("修改用户"):s.html("添加用户");var a=function(n){if(!n.role_list||!n.role_list.length)return!1;var r=n.role_list,i=e("#eui-role",t),s="";for(var o=0;o<r.length;o++)s+=" <div class='md-radio'> <input type='radio' id='radio_"+r[o].id+"' value='"+r[o].id+"' data-name='"+r[o].name+"' name='role' class='md-radiobtn'> <label for='radio_"+r[o].id+"'> <span class='inc'></span> <span class='check'></span> <span class='box'></span> "+r[o].name+" </label></div>";i.html(s)},f=function(){var e=n.attr("data-json"),r;e&&(r=JSON.parse(n.attr("data-json")),u=r&&r.id?r.id:"",a(r));var i={account:r&&r.account?r.account:"",password:r&&r.password?r.password:"",name:r&&r.name?r.name:"",phone:r&&r.phone?r.phone:"",rid:r&&r.rid?r.rid:""};t.find("#eui-account").val(i.account),t.find("#eui-password").val(""),t.find("#eui-name").val(i.name),t.find("#eui-mobile").val(i.phone),t.find("input:radio").prop("checked",!1),t.find("#radio_"+i.rid).prop("checked",!0)};f(),i.unbind().wclick(function(){var r={id:u,account:e.trim(t.find("#eui-account").val()),password:e.trim(t.find("#eui-password").val()),name:t.find("#eui-name").val(),phone:t.find("#eui-mobile").val(),rid:t.find("input[type=radio]:checked").val()},i=e.checkInputVal({val:r.account,type:"email",onChecked:function(t,n,r){n<=0&&e.showToast(r,!1)}});if(i<=0)return!1;var s=r.password.length;if(!r.id)if(s<1||s>50)return e.showToast("密码长度为1-50个字符",!1),!1;var i=e.checkInputVal({val:r.name,type:"name",onChecked:function(t,n,r){n<=0&&e.showToast(r,!1)}});if(i<=0)return!1;var i=e.checkInputVal({val:r.phone,type:"mobile",onChecked:function(t,n,r){n<=0&&e.showToast(r,!1)}});if(i<=0)return!1;e.wpost("/account/update-user-ajax",r,function(i){t.modal("hide");if(u){e.showToast("修改成功",!0),n.attr("data-json",JSON.stringify(r));var s=n.parents("tr").children("td");e(s[0]).html(r.account),e(s[1]).html(r.name),e(s[2]).html(r.phone),e("span",e(s[4])).html(e("#radio_"+r.rid).attr("data-name"))}else e.showToast("添加成功",!0),location.reload()})}),t.modal()}),e(document).on("click",".js_delete",function(){var n=e(this),r=n.attr("data-id");e.confirm({content:"确认删除吗",success:function(){if(!r)return e.showToast("非法操作",!1),!1;e.wpost("/account/delete-ajax",{id:r,type:1},function(){e.showToast("删除成功",!0),t.fnDeleteRow(n.parents("tr"))})}})})});