$(document).ready(function(){var e={modal:$("#editOrAddModal"),pagerObj:"",listContainer:$(".js_table_list"),uploadImageBtn:".js_upload_image",uploadProgressModal:"#uploadAppProgressModal",inputTitle:$(".js_modal_title"),inputImgPosition:$(".js_modal_position"),inputPic:$(".js_modal_img"),inputIcon:$(".js_modal_icon"),inputIconActive:$(".js_modal_icon_active"),inputSubTitle:$(".js_modal_sub_title"),inputContent:$(".js_modal_content"),paramsAddBtn:$(".js_modal_params_add_btn"),paramsSection:$(".js_modal_params"),paramsCloneNode:$(".jmp_node .js_modal_param",$(".js_modal_params")),paramsSectionList:$(".jmp_list",$(".js_modal_params")),initModalParamsEvent:function(){e.paramsAddBtn.unbind().bind("click",function(){var t=e.paramsCloneNode.clone();e.paramsSectionList.append(t)}),$(document).on("click",".jmp_delete",function(){$(this).parents(".js_modal_param").remove()})},getModalParamsData:function(){var t=$(".js_modal_param",e.paramsSectionList),n=t.length,r=[];return n&&t.each(function(e){var t=$(this).find("input"),n=$(this).find("select"),i={id:$.trim(t.eq(0).val()),name:$.trim(t.eq(1).val()),url:$.trim(t.eq(2).val()),target:$.trim(n.val()),sort_num:e+1};i.name.length&&r.push(i)}),r},setModalParamsData:function(t){t&&t.forEach(function(t){var n=e.paramsCloneNode.clone(),r=$(n).find("input"),i=$(n).find("select");r.eq(0).val(t.id),r.eq(1).val(t.name),r.eq(2).val(t.url),i.val(t.target),e.paramsSectionList.append(n)})},clearModalParamsData:function(){e.paramsSectionList.html("")},setModalFormData:function(t){var n=e.modal.find(".modal-title");n.html(n.data("edit")),e.inputTitle.val(t.title),e.inputSubTitle.val(t.sub_title),e.inputImgPosition.val(t.position),e.inputPic.val(t.pic),e.inputIcon.val(t.icon),e.inputIconActive.val(t.icon_active),e.inputContent.val(t.content);var r=document.global_config_data.img_host;$(e.inputPic.data("preview")).attr("src",r+t.pic).removeClass("gone"),$(e.inputIcon.data("preview")).attr("src",r+t.icon).removeClass("gone"),$(e.inputIconActive.data("preview")).attr("src",r+t.icon_active).removeClass("gone"),t.links&&e.setModalParamsData(t.links)},clearModalFormData:function(){var t=e.modal.find(".modal-title");t.html(t.data("new")),e.inputTitle.val(""),e.inputSubTitle.val(""),e.inputImgPosition.val(0),e.inputPic.val(""),e.inputIcon.val(""),e.inputIconActive.val(""),e.inputContent.val(""),$(e.inputPic.data("preview")).attr("src","").addClass("gone"),$(e.inputIcon.data("preview")).attr("src","").addClass("gone"),$(e.inputIconActive.data("preview")).attr("src","").addClass("gone"),e.clearModalParamsData()},initUploadEvent:function(){$(e.uploadImageBtn).unbind().bind("click",function(){var t=$(this),n=$(e.uploadProgressModal);$(this).uploadImage("/upload/upload-image",{request_type:"ajax"},function(e){var r=t.data("id");e.res&&($(r).val(e.path),$(r+"_preview").attr("src",e.url).removeClass("gone")),n.modal("hide"),$(".progress-bar",n).css("width",0)},function(e){n.modal({backdrop:"static",keyboard:!1}),$(".progress-bar",n).css("width",e+"%")})})},initBtnEvent:function(){$(document).on("click",".js_edit",function(){e.clearModalFormData();var t=e.modal.find(".js_submit"),n=$(this),r=n.parents("tr"),i=r.data("id"),s=r.data("info");i&&s&&e.setModalFormData(s),e.modal.modal(),t.unbind().bind("click",function(){var t={id:i,title:$.trim(e.inputTitle.val()),sub_title:$.trim(e.inputSubTitle.val()),position:$.trim(e.inputImgPosition.val()),pic:$.trim(e.inputPic.val()),icon:$.trim(e.inputIcon.val()),icon_active:$.trim(e.inputIconActive.val()),content:$.trim(e.inputContent.val()),links:e.getModalParamsData()},n={title:"请输入标题",pic:"请上传图片",icon:"请上传icon",icon_active:"请上传icon选中图标",sub_title:"请输入描述",content:"请输入内容"};for(var s in n)if(!t[s]||t[s].length<1)return $.showToast(n[s],!1),!1;$.wpost("/home/update-list-ajax",t,function(n){t.id?r.replaceWith(n):e.listContainer.append(n),$.showToast("保存成功",!0),e.modal.modal("hide")})})}),$(document).on("click",".js_delete",function(){var e=$(this),t=e.parents("tr"),n=t.attr("data-id");$.confirm({content:"确认删除吗",success:function(){$.wpost("/home/delete-list-ajax",{id:n},function(){$.showToast("删除成功",!0),e.parents("tr").remove()})}})}),$(document).on("click",".js_up,.js_down",function(){var e=$(this),t=$(e.parents(".js_modal_param")[0]);t.length==0&&(t=$(e.parents("tr")));var n;e.hasClass("js_up")?n=t.prev()[0]:n=t.next()[0];if(!n)return!1;n=$(n);var r=n.clone(),i=t.clone();n.replaceWith(i),t.replaceWith(r)}),$(document).on("click",".js_sort_save",function(){var e=$(".js_table_list tr"),t=[];for(var n=0;n<e.length;n++){var r=$(e[n]),i=r.data("id");if(i){var s={id:i,sort_num:n+1};t.push(s)}}if(t.length<1)return $.showToast("无可排序的数据",!1),!1;$.wpost("/home/save-list-sort-ajax",{params:t},function(){$.showToast("保存成功",!0)})})},run:function(){e.initUploadEvent(),e.initModalParamsEvent(),e.initBtnEvent()}};e.run()});